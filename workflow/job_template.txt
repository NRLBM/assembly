#!/bin/bash

set -euo pipefail

#SBATCH -N 1

TIMESTAMP=REPLACE_TIME

mkdir -p "backup/${TIMESTAMP}"

snakemake -s workflow/assembly.smk --config timestamp="$TIMESTAMP" -j 16 --use-conda --latency-wait 60 --printshellcmds --stats "backup/${TIMESTAMP}/stats_${TIMESTAMP}.json"

snakemake -s workflow/assembly.smk --config timestamp="$TIMESTAMP" -j 16 --use-conda --report "backup/${TIMESTAMP}/report_${TIMESTAMP}.html"

for file in tmp_data/* input/*
do
  echo "Removing $file"
  rm -rf "$file"
done

echo "Het Lisa script ingediend op $TIMESTAMP is zonder foutmeldingen voltooid. De resultaten zijn te vinden in de \"output/${TIMESTAMP}\" map op Lisa." | mail -s "Lisa script ingediend op $TIMESTAMP is klaar" "$(cat .email_user),$(cat .email_bioinformatician)"
